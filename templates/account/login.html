{% extends "base.html" %}

{% block title %}Sign In{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-lg-5">
      <div class="card shadow-lg border-0 rounded-lg mt-5">
        <div class="card-header">
          <h3 class="text-center font-weight-light my-4">Login</h3>
        </div>
        <div class="card-body">
          {% if form.errors %}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
              <span class="alert-text">
                Your username and password didn't match. Please try again.
              </span>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
          {% endif %}
          
          {% if next %}
            {% if user.is_authenticated %}
              <div class="alert alert-warning alert-dismissible fade show" role="alert">
                <span class="alert-text">
                  Your account doesn't have access to this page. To proceed, please login with an account that has access.
                </span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
            {% else %}
              <div class="alert alert-info alert-dismissible fade show" role="alert">
                <span class="alert-text">
                  Please login to see this page.
                </span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
            {% endif %}
          {% endif %}

          <form method="post" action="{% url 'account_login' %}" class="needs-validation" novalidate>
            {% csrf_token %}
            <div class="form-floating mb-3">
              <input class="form-control" id="inputEmail" type="email" name="login" placeholder="name@example.com" required />
              <label for="inputEmail">Email address</label>
              <div class="invalid-feedback">
                Please provide a valid email address.
              </div>
            </div>
            <div class="form-floating mb-3">
              <input class="form-control" id="inputPassword" type="password" name="password" placeholder="Password" required />
              <label for="inputPassword">Password</label>
              <div class="invalid-feedback">
                Please provide a password.
              </div>
            </div>
            <div class="form-check mb-3">
              <input class="form-check-input" id="inputRememberPassword" type="checkbox" name="remember" />
              <label class="form-check-label" for="inputRememberPassword">Remember Password</label>
            </div>
            <div class="d-flex align-items-center justify-content-between mt-4 mb-0">
              <a class="small" href="{% url 'account_reset_password' %}">Forgot Password?</a>
              <button class="btn btn-primary" type="submit">Login</button>
            </div>
            <input type="hidden" name="next" value="{{ next }}" />
          </form>
        </div>
        <div class="card-footer text-center py-3">
          <div class="small">
            <a href="{% url 'account_signup' %}">Need an account? Sign up!</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Hide the sidebar and navbar for the login page
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelector('.sidenav').style.display = 'none';
    document.querySelector('.navbar').style.display = 'none';
    
    // Form validation
    var forms = document.querySelectorAll('.needs-validation');
    Array.prototype.slice.call(forms).forEach(function(form) {
      form.addEventListener('submit', function(event) {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  });
</script>
{% endblock %}
